<!DOCTYPE html>

<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Popularify</title>

    <!--<link rel='icon' href='{{ icon }}' type='image/x-icon' />
    <meta property="og:title" content='{{ previewCardTitle }}'/>
    <meta property="og:url" content='{{ previewCardUrl }}'/>
    <meta property="og:type" content='{{ previewCardWebsite }}'/>
    <meta property="og:description" content='{{ previewCardDescription }}'/> 
    <meta property="og:image" content='{{ previewCardImage }}'/>
    -->

    <!-- jquery 
    <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
    <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script> -->
    
    <!-- jQuery CDN - Slim version (=without AJAX) --> 
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>

    <!-- Popper.JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"
        integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ"
        crossorigin="anonymous"></script>

    <!-- Bootstrap JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"
        integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm"
        crossorigin="anonymous"></script>

    <!-- bootstrap css-->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <!-- jQuery  -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

    <!-- font-awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

</head>

<style>
    .border {
        border-style:solid;
        border-color:#000000;
    }

    .artistOption:hover{
        background:red;
        cursor: pointer;

    }

    .artistRowText{
        font-size:25px;
    }

    .artistColText{
        text-align: center;
    }

    .artistCol:hover{
        background:rgb(206, 205, 205);
        cursor: pointer;
    }

</style>

<!-- Page Content -->
<div style='text-align:center'>

    <!-- header -->
    <div id='header' style='display:block;'>
        <h3>Search For An Artist:</h3>
        <br>
        <input type="text" id="artistSearch"><button id='artistSearchButton'>Search</button>
        <br> <br>
    </div>
    
    <!-- artist search results -->
    <div id="artistSearchResults" class="container" style='display:block;'>
        
        <div class="row">

            <div class='col w-100 border artistCol' artistid="0dmPX6ovclgOy8WWJaFEUU">
                <div style="float:left;" >
                    <img style='width:100px; height:100px;' class='img-fluid' src="https://i.scdn.co/image/e69f71e2be4b67b82af90fb8e9d805715e0684fa">  
                </div> 
                <div class='col artistColText'>
                    <div class='row artistRowText' >
                        Pink Floyd
                    </div>
                    <div class='row artistRowText'>
                        Popularity: 77
                    </div>
                </div>         
            </div>
            
            <div class="w-100"></div>

            <div class='col w-100 border artistCol' artistid="0dmPX6ovclgOy8WWJaFEUU">
                <div style="float:left;" >
                    <img style='width:100px; height:100px;' class='img-fluid' src="https://i.scdn.co/image/e69f71e2be4b67b82af90fb8e9d805715e0684fa">  
                </div> 
                <div class='col artistColText'>
                    <div class='row artistRowText' >
                        Pink Floyd
                    </div>
                    <div class='row artistRowText'>
                        Popularity: 77
                    </div>
                </div>         
            </div>
            
            <div class="w-100"></div>
         
            <div class='col w-100 border artistCol' artistid="0dmPX6ovclgOy8WWJaFEUU">
                <div style="float:left;" >
                    <img style='width:100px; height:100px;' class='img-fluid' src="https://i.scdn.co/image/e69f71e2be4b67b82af90fb8e9d805715e0684fa">  
                </div> 
                <div class='col artistColText'>
                    <div class='row artistRowText' >
                        Pink Floyd
                    </div>
                    <div class='row artistRowText'>
                        Popularity: 77
                    </div>
                </div>         
            </div>
            <div class="w-100"></div>

            <div class='col w-100 border artistCol' artistid="0dmPX6ovclgOy8WWJaFEUU">
                <div style="float:left;" >
                    <img style='width:100px; height:100px;' class='img-fluid' src="https://i.scdn.co/image/e69f71e2be4b67b82af90fb8e9d805715e0684fa">  
                </div> 
                <div class='col artistColText'>
                    <div class='row artistRowText' >
                        Pink Floyd
                    </div>
                    <div class='row artistRowText'>
                        Popularity: 77
                    </div>
                </div>         
            </div>
            
            <div class="w-100"></div>
         
            <div class='col w-100 border artistCol' artistid="0dmPX6ovclgOy8WWJaFEUU">
                <div style="float:left;" >
                    <img style='width:100px; height:100px;' class='img-fluid' src="https://i.scdn.co/image/e69f71e2be4b67b82af90fb8e9d805715e0684fa">  
                </div> 
                <div class='col artistColText'>
                    <div class='row artistRowText' >
                        Pink Floyd
                    </div>
                    <div class='row artistRowText'>
                        Popularity: 77
                    </div>
                </div>         
            </div>
            
            <div class="w-100"></div>

            <div class='col w-100 border artistCol' artistid="0dmPX6ovclgOy8WWJaFEUU">
                <div style="float:left;" >
                    <img style='width:100px; height:100px;' class='img-fluid' src="https://i.scdn.co/image/e69f71e2be4b67b82af90fb8e9d805715e0684fa">  
                </div> 
                <div class='col artistColText'>
                    <div class='row artistRowText' >
                        Pink Floyd
                    </div>
                    <div class='row artistRowText'>
                        Popularity: 77
                    </div>
                </div>         
            </div>
            
            <div class="w-100"></div>
         
            <div class='col w-100 border artistCol' artistid="0dmPX6ovclgOy8WWJaFEUU">
                <div style="float:left;" >
                    <img style='width:100px; height:100px;' class='img-fluid' src="https://i.scdn.co/image/e69f71e2be4b67b82af90fb8e9d805715e0684fa">  
                </div> 
                <div class='col artistColText'>
                    <div class='row artistRowText' >
                        Pink Floyd
                    </div>
                    <div class='row artistRowText'>
                        Popularity: 77
                    </div>
                </div>         
            </div>
            <div class="w-100"></div>

            <div class='col w-100 border artistCol' artistid="0dmPX6ovclgOy8WWJaFEUU">
                <div style="float:left;" >
                    <img style='width:100px; height:100px;' class='img-fluid' src="https://i.scdn.co/image/e69f71e2be4b67b82af90fb8e9d805715e0684fa">  
                </div> 
                <div class='col artistColText'>
                    <div class='row artistRowText' >
                        Pink Floyd
                    </div>
                    <div class='row artistRowText'>
                        Popularity: 77
                    </div>
                </div>         
            </div>
            
            <div class="w-100"></div>
         
            <div class='col w-100 border artistCol' artistid="0dmPX6ovclgOy8WWJaFEUU">
                <div style="float:left;" >
                    <img style='width:100px; height:100px;' class='img-fluid' src="https://i.scdn.co/image/e69f71e2be4b67b82af90fb8e9d805715e0684fa">  
                </div> 
                <div class='col artistColText'>
                    <div class='row artistRowText' >
                        Pink Floyd
                    </div>
                    <div class='row artistRowText'>
                        Popularity: 77
                    </div>
                </div>         
            </div>
            <div class="w-100"></div>

            <div class='col w-100 border artistCol' artistid="0dmPX6ovclgOy8WWJaFEUU">
                <div style="float:left;" >
                    <img style='width:100px; height:100px;' class='img-fluid' src="https://i.scdn.co/image/e69f71e2be4b67b82af90fb8e9d805715e0684fa">  
                </div> 
                <div class='col artistColText'>
                    <div class='row artistRowText' >
                        Pink Floyd
                    </div>
                    <div class='row artistRowText'>
                        Popularity: 77
                    </div>
                </div>         
            </div>
            
            <div class="w-100"></div>
         
            <div class='col w-100 border artistCol' artistid="0dmPX6ovclgOy8WWJaFEUU">
                <div style="float:left;" >
                    <img style='width:100px; height:100px;' class='img-fluid' src="https://i.scdn.co/image/e69f71e2be4b67b82af90fb8e9d805715e0684fa">  
                </div> 
                <div class='col artistColText'>
                    <div class='row artistRowText' >
                        Pink Floyd
                    </div>
                    <div class='row artistRowText'>
                        Popularity: 77
                    </div>
                </div>         
            </div>
            
            <div class="w-100"></div>

            <div class='col w-100 border artistCol' artistid="0dmPX6ovclgOy8WWJaFEUU">
                <div style="float:left;" >
                    <img style='width:100px; height:100px;' class='img-fluid' src="https://i.scdn.co/image/e69f71e2be4b67b82af90fb8e9d805715e0684fa">  
                </div> 
                <div class='col artistColText'>
                    <div class='row artistRowText' >
                        Pink Floyd
                    </div>
                    <div class='row artistRowText'>
                        Popularity: 77
                    </div>
                </div>         
            </div>
            
            <div class="w-100"></div>
         
            <div class='col w-100 border artistCol' artistid="0dmPX6ovclgOy8WWJaFEUU">
                <div style="float:left;" >
                    <img style='width:100px; height:100px;' class='img-fluid' src="https://i.scdn.co/image/e69f71e2be4b67b82af90fb8e9d805715e0684fa">  
                </div> 
                <div class='col artistColText'>
                    <div class='row artistRowText' >
                        Pink Floyd
                    </div>
                    <div class='row artistRowText'>
                        Popularity: 77
                    </div>
                </div>         
            </div>
            
        </div>
    </div>
    
    <!-- footer -->
    <div id='footer' style='display:block;'>
        <br>
        <h3>Login:</h3><a href="/spotifyLogin" class="button">Login</a>

        <br>
        loggedIn={{loggedIn}}
        <br>
        access_token=<div id='access_token'>{{access_token}}</div>
        <br>

        <h3>Enter Spotify Artist URI</h3>
        <input size="22" type="text" placeholder='Spotify URI' name="url" id="uriInput">
        <button style="cursor: pointer;" name="data" type="button" onclick="submitUri(document.getElementById('uriInput').value); ">Submit</button>
    </div>

</div>

<script type="text/javascript">

    //when uri button is submitted
    async function submitUri(uri){
        uri='spotify:artist:3x3jSlhyv5CiCZDZlaTq0M'
        console.log('submitUri() uri = ', uri)
        try{
            let artistData = await getArtistData(uri)
            console.log('submitUri() artistData=',artistData)
        }catch(err){
            console.log('submitUri() err=',err)
        }
    }

    //get artist data sorted by popularitty
    async function getArtistData(uri){
        return new Promise(function (resolve, reject) {
            $.ajax({
                type: 'POST',
                url: '/spotifyApi',
                data: {
                    uri: uri,
                    access_token: document.getElementById('access_token').innerText
                },
            }).then((resp) => {
                //if (resp.status == 400) {
                //    console.log('/discogsAPI res.status=400, resp = ', resp)
                //}
                resolve(resp)
            }).catch((err) => {
                console.log('getArtistData() err = ', err)
                reject(err)
            });
        });
    }

    //search spotify for artist, and get dropdown results
    async function getArtistSearchResults(input){
        return new Promise(function (resolve, reject) {
            $.ajax({
                type: 'POST',
                url: '/spotifySearch',
                data: {
                    input: input,
                },
            }).then((resp) => {
                resolve(resp)
            }).catch((err) => {
                reject(err)
            });
        });
    }

    //await formatArtistResultsAsHTML(artistSearchResults)
    async function formatArtistResultsAsHTML(artistSearchResults){
        return new Promise(function (resolve, reject) {
            //sort data via popularity
            artistSearchResults = artistSearchResults.sort((a, b) => parseFloat(b.popularity) - parseFloat(a.popularity));

            //create row div
            var rowDiv = document.createElement("div");
            rowDiv.setAttribute('class', 'row')

            //create col element for each artist search result
            for(var x = 0; x < artistSearchResults.length; x++){
                //get important data variables
                let artistName = artistSearchResults[x].name;
                let artistImg = "../../static/assets/img/spotifyArtistUnknown.jpg";
                if(artistSearchResults[x].images.length >= 1){
                    artistImg = artistSearchResults[x].images[0].url
                }
                let artistPopularity = artistSearchResults[x].popularity;
                let artistId = artistSearchResults[x].id;
                //construct html
                
                var colDiv = document.createElement("div");
                colDiv.setAttribute('class', 'artistOption')
                //colDiv.setAttribute('class', 'col-md-4')
                colDiv.innerHTML = `
                    <div onClick='chosenArtist("${artistId}")' class='col w-100 border' style='background:yellow;' artistId='${artistId}'>
                        
                        <div style="float:left;" >
                            <img style='width:100px; height:100px;' class='img-fluid' src="${artistImg}">  
                        </div> 

                        <div style="font-size:2vh; float:left;" >
                            <p>${artistName}, Popularity: ${artistPopularity}</p>  
                        </div> 
                                   
                    </div>`;

                var dividerDiv = document.createElement('div')
                dividerDiv.setAttribute('class', 'w-100')
                
                //add col element to row element
                rowDiv.appendChild(colDiv)
                //add divider element
                rowDiv.appendChild(dividerDiv)
            }
            //return constructed html
            //var tempReturn = document.createElement("div");
            //tempReturn.innerText = 'temp'
            resolve(rowDiv)
        })
    }

    async function chosenArtist(input){
        console.log('chosenArtist = ', input)
    }

    $(document).ready(function () {
        //artist row is clicked
        $('.artistCol').click(function(e){
            console.log('artistCol() clicked, artistid=', $(this).attr('artistid'))
        });

        //artist search button is clicked
        $( "#artistSearchButton" ).click(async function() {
            
            //get input text
            let textInputField = document.getElementById('artistSearch').value;
            console.log('searching for artists with name:', textInputField);

            //make spotify api query for artists
            let artistSearchResults = await getArtistSearchResults(textInputField)
            console.log('artistSearchResults = ', artistSearchResults)
            
            //format artist results as html
            let artistResultsHTML = await formatArtistResultsAsHTML(artistSearchResults)
            console.log('artistResultsHTML=',artistResultsHTML)
            //display html on page
            document.getElementById('artistSearchResults').innerHTML = '';
            document.getElementById('artistSearchResults').appendChild(artistResultsHTML)
        });
    });

</script>

</html>